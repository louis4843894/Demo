<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>登入 · 社區客服系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a443f" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- Material Web -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:FILL@0..1" rel="stylesheet" />
  <script type="module">import 'https://esm.run/@material/web/all.js';</script>

  <style>
    html,body{height:100%}
    body{margin:0;font-family: Roboto, system-ui, -apple-system, "Segoe UI", Arial; background:#f6f7fb; display:grid; place-items:center}
    .card{background:#fff; width:min(520px, calc(100vw - 24px)); border-radius:18px; box-shadow:0 16px 48px rgba(0,0,0,.1); padding:22px}
    .muted{opacity:.66}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0 0 4px; font-weight:900; letter-spacing:.3px">登入系統</h2>
    <div class="muted" style="margin-bottom:14px">使用測試帳號登入。選擇角色可進入後台或一般功能頁。</div>

    <div class="row">
      <md-outlined-text-field id="email" label="Email" value="test@example.com" style="flex:1 1 240px"></md-outlined-text-field>
      <md-outlined-text-field id="password" label="密碼" type="password" value="123456" style="flex:1 1 160px"></md-outlined-text-field>
    </div>

    <div style="margin:10px 0 6px">角色</div>
    <div class="row" role="radiogroup" aria-label="角色">
      <md-filter-chip id="role_user" selected>一般使用者</md-filter-chip>
      <md-filter-chip id="role_admin">Admin</md-filter-chip>
      <md-filter-chip id="role_committee">Committee</md-filter-chip>
    </div>

    <div class="row" style="margin-top:16px">
      <md-filled-button id="btnLogin">
        <span class="material-symbols-outlined" slot="icon">login</span>登入
      </md-filled-button>
      <md-outlined-button onclick="location.href='index.html'">
        <span class="material-symbols-outlined" slot="icon">home</span>回首頁
      </md-outlined-button>
    </div>

    <div class="muted" style="margin-top:16px" id="nextInfo"></div>
  </div>

  <script src="index.js"></script>
  <script>
    const q = parseQuery(location.search);
    const next = decodeURIComponent(q.next || '') || '';

    document.getElementById('nextInfo').textContent = next ? `登入後將前往：${next}` : '登入後將前往：app.html';

    // 若已登入，直接走轉向
    if (isLoggedIn()) {
      redirectAfterLogin(next, getRole());
    }

    // 角色切換
    const chips = {
      user: document.getElementById('role_user'),
      admin: document.getElementById('role_admin'),
      committee: document.getElementById('role_committee')
    };
    Object.entries(chips).forEach(([k,chip])=>{
      chip.addEventListener('click', ()=>{
        Object.values(chips).forEach(c=>c.selected=false);
        chip.selected = true;
      });
    });

    document.getElementById('btnLogin').addEventListener('click', ()=>{
      const email = document.getElementById('email').value.trim();
      const pwd   = document.getElementById('password').value;
      const role  = chips.admin.selected ? 'admin' : (chips.committee.selected ? 'committee' : 'user');

      // 簡化驗證
      if (!email) { alert('請輸入 Email'); return; }
      if (!pwd)   { alert('請輸入密碼'); return; }

      setUser({ email, name: email.split('@')[0], role });
      redirectAfterLogin(next, role);
    });
  </script>
</body>
</html>
